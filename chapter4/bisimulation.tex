\begin{definition}
	Given $\rel \subseteq Conf \times Conf$ be a relation over quantum configurations, let its quantum lifting be the minimal relation $\slift{\rel} \subseteq D(Conf) \times D(Conf)$ such that
	\begin{itemize}
		\item $\conf\ \rel\ \conf'$ implies $\overline{\conf}\ \slift{\rel}\ \overline{\conf'}$;
		\item $\Delta_i\ \slift{\rel}\ \Theta_i$, $i = 1, 2$, implies $\Delta_1 \psum{p} \Delta_2 \slift{\rel}\ \Theta_1 \psum{p} \Theta_2$;
		\item $\overline{\confw{\rho, P}} \psum{p} \overline{\confw{\sigma, P}} \slift{\rel} \overline{\confw{p \rho + (1-p)\sigma, P}}$.
	\end{itemize} 
\end{definition}


%In the following we write $qv(P)$ or $qv(\confw{\rho, P})$ for the set of free quantum variables in $P$, and $env(\confw{\rho, P})$ for $tr_{qv(P)}(\rho)$.

\begin{definition}[Barb]
	A \emph{barb} is a predicate $\downarrow_{c}$ over configurations where $\langle \rho, P \rangle \downarrow_{c}$ iff $P \equiv c!x + Q \parallel R$ for some $x$, and processes $Q$, $R$.
%	A \emph{barb} is a predicate $\downarrow_{p, c}$ over configurations where $\langle \rho, P \rangle \downarrow_{p, c}$ iff $tr(\rho) = p$ and
%	$P \equiv c!x + Q \parallel R$ for some $x$, and processes $Q$, $R$.
\end{definition}

%\begin{definition}[Barb Preserving Relation]
%	A relation $\rel \subseteq \conf \times \conf$ is \emph{barb preserving} if $\conf \rel \conf'$ implies that $\barb{p}{c}{\conf}$ iff $\barb{p}{c}{\conf'}$
%	for any $p \in [0,1]$ and any classical channel $c$.
%\end{definition}

%\begin{definition}[Probabilistic Barbed Bisimulation]
%	A symmetric relation $\rel_{\Gamma, \Sigma} \subseteq \conf \times \conf$ is \emph{probabilistic barbed bisimulation} if $\conf \rel \conf'$, with $\conf, \conf'$ well-typed under the context $\Gamma; \Sigma$, implies that 
%	\begin{itemize}
%		\item if $\conf \downarrow_{c}$ then $\conf' \downarrow_{c}$; and 
%		\item whenever $\conf \xrightarrow{\tau} \Delta$, there exists $\Delta'$ such that $\conf' \xrightarrow{\tau} \Delta'$ and $\Delta \slift{\rel} \Delta'$
%%		\item whenever $\conf' \xrightarrow{\tau} \Delta'$, there exists $\Delta$ such that $\conf \xrightarrow{\tau} \Delta$ and $\Delta \slift{\rel} \Delta'$
%	\end{itemize}
%\end{definition}

A typed context $B_{\Gamma; \Sigma}$ is generated by the grammar
\[
B \Coloneqq \ [\_]_{\Gamma; \Sigma} \mid B \parallel P
\]
and typed according to the typing rules:

\[
 \infer[\mbox{\footnotesize\scshape Hole}]{\Gamma; \Sigma \vdash [\_]_{\Gamma; \Sigma}}{} 
 \qquad \infer[\mbox{\footnotesize\scshape ParHole}]{\Gamma \cup \Gamma'; \Sigma \cup \Sigma' \vdash B \parallel P}
{\Gamma; \Sigma \vdash B & \Gamma'; \Sigma' \vdash P & \Sigma \cap \Sigma' = \emptyset}
\]

\begin{definition}[Saturated Probabilistic Barbed Bisimilarity]
	A symmetric relation $\rel \subseteq \conf \times \conf$ is \emph{saturated probabilistic barbed bisimulation} if $\conf\ \rel\ \conf'$ implies that $\conf, \conf'$ are well-typed under a typing context $\Gamma; \Sigma$, and for any typed context $B_{\Gamma;\Sigma}$
	\begin{itemize}
		\item if $B[\conf] \downarrow_{c}$ then $B[\conf'] \downarrow_{c}$; and 
		\item whenever $B[\conf] \xrightarrow{\tau} \Delta$, there exists $\Delta'$ such that $B[\conf'] \xrightarrow{\tau} \Delta'$ and $\Delta \slift{\rel} \Delta'$
		%		\item whenever $\conf' \xrightarrow{\tau} \Delta'$, there exists $\Delta$ such that $\conf \xrightarrow{\tau} \Delta$ and $\Delta \slift{\rel} \Delta'$
	\end{itemize}
	Let \emph{saturated probabilistic barbed bisimilarity} $\approx_{SPB}$ be such that $\conf \approx_{SPB} \conf'$ iff a bisimulation $\rel$ exists such that $\conf\ \rel\ \conf'$. 
\end{definition}

\begin{theorem}
	For any pair of configurations $\conf, \conf'$ well-typed under $\Gamma; \Sigma$, 
	$\conf \approx_{SPB} \conf'$ implies
	\begin{enumerate}
		\item for any $\sop \in TSO(\hilbert_{\overline{\Sigma}})$, $\sop (\conf)\ \approx_{SPB}\ \sop (\conf')$; and
		\item for each $\conf_f, \conf_f'$ such that $\conf \Rightarrow \conf_f \not\rightarrow$ and $\conf' \Rightarrow \conf_f' \not\rightarrow$, $env(\conf_f) = env(\conf_f')$.
	\end{enumerate}
\end{theorem}




%\begin{definition}[FD-barbed congruence]
%	A probabilistic barbed bisimulation $\rel \subseteq \conf \times \conf$ is a \emph{FD-barbed congruence} if $\conf \rel \conf'$ implies that 
%	\begin{itemize}
%		\item $(\conf \parallel P) \rel (\conf' \parallel P)$ for any process $P$ with $qv(P)$ disjoint from $qv(\conf) \cup qv(\conf')$ 
%		\item $\sop (\conf) \rel \sop (\conf')$ for any $\sop \in TSO(\hilbert_{\overline{qv(\conf)}})$
%	\end{itemize}
%\end{definition}
%
%The following congruence was proposed in~\cite{Deng:2012} by Feng and Deng.
%\begin{definition}
%	Let FD-congruence is the largest relation $\approx_{FD} \subseteq \conf \times \conf$ which is barb preserving, reduction closed, compositional and such that if $\conf \rel \conf'$ implies $qv(\conf) = qv(\conf')$ and $env(\conf) = env(\conf')$.
%\end{definition}
%
%\begin{definition}[open FD-simulation and bisimulation]
%	A relation $\rel \subseteq \conf \times \conf$ is an \emph{open FD-simulation} if $\conf \rel \conf'$ implies that $qv(\conf) = qv(\conf')$, $env(\conf) = env(\conf')$ and, for all $\sop \in TSO(\hilbert_{\overline{qv(\conf)}})$,
%	\begin{itemize}
%		\item whenever $\sop(\conf) \xrightarrow{\alpha} \Delta$, there is some $\Delta'$ such that $\sop(\conf') \xrightarrow{\alpha} \Delta'$ and $\Delta \slift{\rel} \Delta'$.
%	\end{itemize}
%
%	A relation $\rel \subseteq \conf \times \conf$ is an \emph{open FD-bisimulation} iff $\rel$ and $\rel^{-1}$ are open FD-simulations.
%	
%	Let FD-open bisimilarity $\approx_{oFD}$ be the largest FD-open bisimulation. 
%\end{definition}
%
%The following theorem is proved in~\cite{Deng:2012}.
%\begin{theorem}
%	$\conf \approx_{FD} \conf'$ iff $\conf \approx_{oFD} \conf'$
%\end{theorem}

%\begin{definition}[Barbed Simulation]
%  A relation $\mathcal{R}_{\Gamma, \Sigma}$ is called a \emph{barbed simulation} if it is closed under the $\boxplus$-operator and for each
%  pair of configurations $\langle \rho, P \rangle$, $\langle \sigma, Q \rangle$, well-typed under the context $\Gamma; \Sigma$, it holds that:
%  \begin{enumerate}
%    \item if $\langle \rho, P \rangle \longrightarrow \boxplus_{i \in I} \langle \rho_i, P_i \rangle$, then
%      $\langle \sigma, Q \rangle \longrightarrow \boxplus_{j \in J} \langle \sigma_j, Q_j \rangle$, and
%      $\forall i \in I \ldotp \exists j \in J \ldotp \langle \rho_i, P_i \rangle \mathcal{R}_{\Gamma, \Sigma} \langle \sigma_j, Q_j \rangle $;
%    \item if $\langle \rho, P \rangle \downarrow_{p, c}, then \langle \sigma, Q \rangle \downarrow_{p, c}$.
%  \end{enumerate}
%\end{definition}
% 
%\begin{definition}[Barbed Bisimulation]
%  A relation $\mathcal{R}_{\Gamma, \Sigma}$ is called a \emph{barbed bisimulation} if it's symmetric, closed under the $\boxplus$-operator and for each
%  pair of configurations $\langle \rho, P \rangle$, $\langle \sigma, Q \rangle$, well-typed under the context $\Gamma, \Sigma$ it holds that:
%  \begin{enumerate}
%    \item if $\langle \sigma, \rho \rangle \longrightarrow \boxplus_{i \in I} \langle \rho_i, P_i \rangle$, then
%      $\langle \sigma, q \rangle \longrightarrow \boxplus_{i \in I} \langle \sigma_i, Q_i \rangle$, and
%      $\forall i \in I \ldotp \langle \rho_i, P_i \rangle \mathcal{R}_{\Gamma, \Sigma} \langle \sigma_i, Q_i \rangle$;
%    \item if $\langle \rho, P \rangle \downarrow_{p, c}, then \langle \sigma, Q \rangle \downarrow_{p, c}$.
%  \end{enumerate}
%\end{definition}
